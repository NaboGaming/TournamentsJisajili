<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>
</head>
<body>
    <h1>Welcome to your Dashboard, <span id="userName"></span></h1>
    <p>Email: <span id="userEmail"></span></p>
    <img id="userProfilePicture" src="" alt="Profile Picture">
    <p>
        Game Name: <input type="text" id="gameName"><br>
        Game ID: <input type="text" id="gameID"><br><br>
        <button class="squadBtn" id="squad1">Squad 1</button>
        <button class="squadBtn" id="squad2">Squad 2</button>
        <button class="squadBtn" id="squad3">Squad 3</button>
        <button class="squadBtn" id="squad4">Squad 4</button>
    </p>
   <script defer type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyC_VKdV-KsIzUiOb7jFLsYXdTsuGkLiS-Q",
        authDomain: "register-71bde.firebaseapp.com",
        projectId: "register-71bde",
        storageBucket: "register-71bde.appspot.com",
        messagingSenderId: "412548441298",
        appId: "1:412548441298:web:e0fb2b6c5fbd4af7d0b90b"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const realtimeDb = getDatabase(app);

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            document.getElementById("userName").textContent = user.displayName;
            document.getElementById("userEmail").textContent = user.email;
            document.getElementById("userProfilePicture").src = user.photoURL;

            const squadBtns = document.querySelectorAll(".squadBtn");
            squadBtns.forEach(btn => {
                btn.addEventListener('click', async () => {
                    const gameName = document.getElementById("gameName").value;
                    const gameID = document.getElementById("gameID").value;
                    if (gameName && gameID) {
                        const selectedSquad = btn.id;
                        const userSquadRef = ref(realtimeDb, `userSquads/${user.uid}`);
                        const userSquadSnapshot = await get(child(userSquadRef, 'selectedSquad'));
                        if (userSquadSnapshot.exists()) {
                            alert("You have already submitted a squad selection.");
                        } else {
                            // Save game name and game ID
                            set(ref(realtimeDb, `userSquads/${user.uid}/gameName`), gameName);
                            set(ref(realtimeDb, `userSquads/${user.uid}/gameID`), gameID);
                            set(ref(realtimeDb, `userSquads/${user.uid}/selectedSquad`), selectedSquad);
                            alert("Squad selection submitted successfully!");
                            window.location.href = "newpage.html";
                        }
                    } else {
                        alert("Please enter game name and game ID before selecting a squad.");
                    }
                });
            });

            // Check if squad has already been submitted and redirect
            const userSquadRef = ref(realtimeDb, `userSquads/${user.uid}`);
            const userSquadSnapshot = await get(child(userSquadRef, 'selectedSquad'));
            if (userSquadSnapshot.exists()) {
                window.location.href = "newpage.html";
            }
        } else {
            // Handle if the user is not logged in
        }
    });
</script>
</body>
</html>